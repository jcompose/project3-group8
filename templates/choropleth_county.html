<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Average Price by County - Choropleth Map</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>
    <h1>Average Property Price by County (Choropleth Map)</h1>
    <div id="map"></div>

    <script>
        const chart = echarts.init(document.getElementById('map'));

        Promise.all([
            fetch('/api/real_estate/avg_price_county').then(res => res.json()),
            // Public geojson data for the boundaries of California's 58 counties. Convenient!
            fetch('https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/california-counties.geojson').then(res => res.json())
        ])
        .then(([countyData, geoJson]) => {
            echarts.registerMap('california', geoJson);

            const dataMap = {};
            countyData.forEach(item => {
                dataMap[item.county] = item.avgPrice;
            });

            const formattedData = geoJson.features.map(feature => ({
                name: feature.properties.name,
                value: dataMap[feature.properties.name] || 0 // Fill 0 if no data
            }));

            chart.setOption({
                title: { text: 'Average Property Price by County', left: 'center' },
                tooltip: {
                    trigger: 'item',
                    formatter: params => `${params.name}: $${params.value.toLocaleString()}`
                },
                visualMap: {
                    min: 0,
                    max: 2000000, // Adjust depending on price range(?)
                    text: ['High', 'Low'],
                    realtime: false,
                    calculable: true,
                    color: ['#00429d', '#97d4e9']
                },
                series: [{
                    type: 'map',
                    map: 'california',
                    roam: true,
                    label: { show: false },
                    data: formattedData
                }]
            });
        })
        .catch(error => console.error('Error loading data:', error));
    </script>
</body>
</html>
