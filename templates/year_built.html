<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Property Age Distribution</title>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist/plotly.min.js"></script>
    <style>
        #density-plot {
            width: 100%;
            height: 800px;
        }
    </style>
</head>
<body>
    <h1>Property Age Distribution Histogram</h1>
    <div id="percentage-histogram"></div>

    <script>
        // Fetch data from Flask API route
        fetch('/api/real_estate/yearbuilt')
            .then(response => response.json())
            .then(data => {
                // Extract years and counts
                const years = [];
                const counts = [];

                data.forEach(item => {
                    for (let i = 0; i < item.propertyCount; i++) {
                        years.push(item.yearBuilt);
                    }
                    counts.push(item.propertyCount);
                });
                Plotly.newPlot('percentage-histogram', [{
                    x: years,
                    type: 'histogram',
                    histnorm: 'percent',
                    opacity: 0.7,
                    marker: {
                        color: 'rgba(100, 149, 237, 0.7)'
                    },
                    xbins: {
                        size: 5
                    },
                    hovertemplate: '%{x}, %{y:.2f}%<extra></extra>'
                }], {
                    title: 'Property Age Distribution',
                    xaxis: {
                        title: { text: 'Year Built' },
                        tickformat: 'd',
                        range: [1850, 2025],
                        dtick: 10
                    },
                    yaxis: {
                        title: { text: 'Percentage of Houses' },
                        tickformat: '.2f',
                        range: [0, 7]
                    },
                    bargap: 0.05
                });
            })
            .catch(error => console.error('Error loading data:', error));
    </script>
</body>
</html>
